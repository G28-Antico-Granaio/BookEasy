"use strict";(()=>{var e={};e.id=390,e.ids=[390],e.modules={1185:e=>{e.exports=require("mongoose")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},2880:(e,a,r)=>{r.r(a),r.d(a,{headerHooks:()=>v,originalPathname:()=>f,patchFetch:()=>q,requestAsyncStorage:()=>w,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>y});var t={};r.r(t),r.d(t,{POST:()=>c});var s=r(5419),o=r(9108),i=r(9678),n=r(1694),u=r(7165),p=r(8070),d=r(6521),l=r.n(d);async function c(e,{params:a}){try{let r=await e.json(),t=await fetch(`http://localhost:3000/api/user/${a.email}`);if(!t)throw Error("(!!) Utente non trovato");let s=await t.json();if(await l().compare(r.password,s.data.password))throw Error("(!!) Password vecchia e nuova corrispondono");let o=await l().genSalt(10),i=await l().hash(r.password,o);return r.password=i,await u.Z.findOneAndUpdate({email:a.email},r,{new:!0}),p.Z.json({success:!0,message:"Password modificata"},{status:200})}catch(e){return console.error(" - ERRORE: \xe8 avvenuto un problema durante l'uso dell'api di 'api/reset-password/[email]' --> "+e.message),p.Z.json({success:!1,message:e.message||"Si \xe8 verificato un errore durante il reset della password"},{status:e.status||500})}}(0,n.I)();let m=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/reset-password/[email]/route",pathname:"/api/reset-password/[email]",filename:"route",bundlePath:"app/api/reset-password/[email]/route"},resolvedPagePath:"C:\\Users\\aless\\Desktop\\uni\\BookEasy\\app\\api\\reset-password\\[email]\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:w,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:v,staticGenerationBailout:y}=m,f="/api/reset-password/[email]/route";function q(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},7165:(e,a,r)=>{r.d(a,{Z:()=>i});var t=r(1185),s=r.n(t);let o=new(s()).Schema({_id:{type:String},name:{type:String,required:!0},surname:{type:String,required:!0},tel_number:{type:Number,required:!0},tel_area_code:{type:Number,required:!0},email:{type:String,required:!0,unique:!0},isAdmin:{type:Boolean,default:!1,require:!1},password:{type:String,required:!0}},{timestamps:!0}),i=s().models.User||s().model("User",o)},1694:(e,a,r)=>{r.d(a,{I:()=>o});var t=r(1185),s=r.n(t);let o=async()=>{try{await s().connect(process.env.MONGO_URL),console.log(" - Connessione al DataBase riuscita")}catch(e){console.log(" - ERRORE: si \xe8 verificato un problema nella connessione al DataBase --> ",e.message)}}}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[638,206,521],()=>r(2880));module.exports=t})();